import{G as K,Y,K as t,A as $,b as D,q as G,T as p,e as W,j as l,v as u,S as _,p as a,t as y,r as d,a as B,c as H,X as m,$ as I,J as F,d as v}from"./index-c2be6f26.js";import{E as X}from"./Navbar-a4e8e732-1eb05fa5.js";import{s as J}from"./_plugin-vue_export-helper-c27b6911-f875bd67.js";const i=b=>(K("data-v-03e96025"),b=b(),Y(),b),Q={class:"container mx-auto px-4 sm:px-6 lg:px-8"},V={class:"flex flex-col lg:flex-row lg:justify-between"},Z={class:"w-full lg:w-2/3"},tt={class:"flex flex-col mt-8"},et={class:"flex justify-between"},at=i(()=>t("h2",{class:"text-lg font-medium leading-6 text-gray-900"},"Shopping Cart",-1)),st={key:0},rt={class:"flex-1 mt-4"},ot={class:"overflow-x-auto"},nt={class:"min-w-full divide-y divide-gray-200"},it=i(()=>t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{scope:"col",class:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase"}," Product "),t("th",{scope:"col",class:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase"}," Price "),t("th",{scope:"col",class:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase"}," Quantity "),t("th",{scope:"col",class:"px-6 py-3 text-xs font-medium tracking-wider text-left text-gray-500 uppercase"}," Total "),t("th",{scope:"col",class:"relative px-6 py-3"},[t("span",{class:"sr-only"},"Remove")])])],-1)),ct={class:"bg-white divide-y divide-gray-200"},lt={class:"px-6 py-4 whitespace-nowrap"},ut={class:"flex items-center"},dt={class:"flex-shrink-0 w-10 h-10"},ft=["src"],pt={class:"ml-4"},gt={class:"text-sm font-medium text-gray-900"},yt={class:"text-sm text-gray-500"},mt={class:"px-6 py-4 whitespace-nowrap"},ht={class:"text-sm text-gray-900"},xt={class:"px-6 py-4 whitespace-nowrap"},wt={class:"flex items-center justify-between w-24"},vt=["onClick"],bt=i(()=>t("svg",{class:"w-4 h-4 fill-current",viewBox:"0 0 20 20"},[t("path",{d:"M5 10h10v1H5z"})],-1)),Ct=[bt],kt={class:"text-gray-700"},Ot=["onClick"],Tt=i(()=>t("svg",{class:"w-4 h-4 fill-current",viewBox:"0 0 20 20"},[t("path",{d:"M10 5v10h1V5z"}),t("path",{d:"M5 10h10v1H5z"})],-1)),St=[Tt],_t={class:"px-6 py-4 whitespace-nowrap"},Et={class:"text-sm text-gray-900"},Bt={class:"px-6 py-4 whitespace-nowrap"},It=["onClick"],$t=i(()=>t("svg",{class:"w-4 h-4 fill-current",viewBox:"0 0 20 20"},[t("path",{d:"M10 18a8 8 0 100-16 8 8 0 000 16zM6.3 6.3a1 1 0 011.4 0L10 8.6l2.3-2.3a1 1 0 011.4 1.4L11.4 10l2.3 2.3a1 1 0 01-1.4 1.4L10 11.4l-2.3 2.3a1 1 0 01-1.4-1.4L8.6 10 6.3 7.7a1 1 0 010-1.4z"})],-1)),At=[$t],Mt={class:"w-full lg:w-1/3 mt-8 lg:mt-0"},qt={class:"bg-white p-4 rounded-md shadow-md"},Ut=i(()=>t("h3",{class:"text-lg font-medium leading-6 text-gray-900"},"Summary",-1)),Nt={class:"mt-4"},Pt={class:"flex justify-between text-sm font-medium text-gray-600"},Lt=i(()=>t("span",null,"Subtotal:",-1)),Rt=i(()=>t("div",{class:"flex justify-between mt-2 text-sm font-medium text-gray-600"},[t("span",null,"Shipping:"),t("span",null,"$0.00")],-1)),jt=i(()=>t("hr",{class:"mt-2 mb-4"},null,-1)),zt={class:"flex justify-between text-lg font-medium text-gray-900"},Kt=i(()=>t("span",null,"Total:",-1)),Yt={key:0,class:"mt-4"},Dt={key:0},Gt=i(()=>t("h1",{class:"text-lg mt-1"},"STEP 1",-1)),Wt={key:1},Ht=i(()=>t("h2",{class:"text-lg mt-1"},"STEP 2",-1)),Ft=i(()=>t("div",{id:"mp"},null,-1)),Xt={key:2},Jt=i(()=>t("label",null,[t("strong",null,"Important:"),$(" We are waiting for your payment to be confirmed, if your payment is pending you will not be able to continue. If you have already made your payment, all you have to do is click on the following button to confirm your purchase!")],-1)),Qt={key:0,class:"flex mt-2 mb-2 custom-error"},Vt={style:{width:"95%","text-align":"center","text-transform":"uppercase"},class:"mt-2 mb-2"},Zt={key:0},te={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center"},ee=i(()=>t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75"},null,-1)),ae=i(()=>t("div",{class:"flex items-center justify-center w-12 h-12 mx-auto mb-4 text-green-500 bg-green-100 rounded-full"},[t("svg",{class:"w-6 h-6 fill-current",viewBox:"0 0 20 20"},[t("path",{d:"M17.707 4.293c-.391-.391-1.023-.391-1.414 0l-7.293 7.293-3.293-3.293c-.391-.391-1.023-.391-1.414 0-.391.391-.391 1.023 0 1.414l4 4c.195.195.451.293.707.293s.512-.098.707-.293l8-8c.391-.391.391-1.023 0-1.414z"})])],-1)),se=i(()=>t("p",{class:"text-lg font-medium text-gray-800"},"Purchase completed! We will shortly be sending you an email with the details.",-1)),re={class:"mt-6"},oe={class:"px-4 py-2 text-sm font-medium text-white bg-green-500 rounded hover:bg-green-600 focus:outline-none focus:ring focus:ring-green-500"},ne={key:1},ie={class:"flex items-center justify-center min-h-screen px-4 pt-4 pb-20 text-center"},ce=i(()=>t("div",{class:"fixed inset-0 bg-gray-500 bg-opacity-75"},null,-1)),le=i(()=>t("div",{class:"flex items-center justify-center w-12 h-12 mx-auto mb-4 text-green-500 bg-green-100 rounded-full"},[t("svg",{class:"w-6 h-6 fill-current",viewBox:"0 0 20 20"},[t("path",{d:"M17.707 4.293c-.391-.391-1.023-.391-1.414 0l-7.293 7.293-3.293-3.293c-.391-.391-1.023-.391-1.414 0-.391.391-.391 1.023 0 1.414l4 4c.195.195.451.293.707.293s.512-.098.707-.293l8-8c.391-.391.391-1.023 0-1.414z"})])],-1)),ue=i(()=>t("p",{class:"text-lg font-medium text-gray-800"},"Your purchase was successful! Although due to lack of stock some of your products could not be included. Don't worry, you can continue shopping and we will notify you when there is stock!. ",-1)),de={class:"mt-6"},fe={__name:"ShopCartView",setup(b){const o=D(),g=G();let f=p(0);p(!1);let x=p(!1),w="",k=p(!1),C=p(!1),E=null,h=p(!0),O=p(!1),T=p(!1),S=p(!1);function A(){x.value=!1,w=""}async function M(n){const r=o.productsOnCart.find(c=>c._id===n);console.log(r);const s=`https://backend-production-2f21.up.railway.app/api/carts/${o.cart_id}/products/${n}`,e=await v.put(s,{quantity:"1"});if(e.data&&e.data.status==!0){r.quantity++;const c=await r.price;f.value+=await c}else x.value=!0,w="There was an error trying to increase"}async function q(n){var r;const s=`https://backend-production-2f21.up.railway.app/api/carts/${o.cart_id}/products/${n}`,e=await v.delete(s,{});e.data?e.data.status==!0?o.productsOnCart=o.productsOnCart.filter(c=>c._id!=n):console.error((r=e.data)==null?void 0:r.message):console.error("the action could not be completed")}async function U(n){const r=o.productsOnCart.find(s=>s._id===n);if(r.quantity>1){const s=`https://backend-production-2f21.up.railway.app/api/carts/${o.cart_id}/products/${n}`,e=await v.put(s,{quantity:"-1"});if(e.data&&e.data.status==!0){r.quantity--;const c=await r.price;f.value-=await c}else x.value=!0,w="There was an error trying to decrement quantity"}}async function N(){Swal.fire({icon:"warning",text:"IF YOU CONFIRM THE CART YOU WILL NOT BE ABLE TO CONTINUE ADDING QUANTITIES OR DELETE PRODUCTS UNTIL YOU COMPLETE YOUR PURCHASE, DO YOU WANT TO CONTINUE?",showCancelButton:!0,allowOutsideClick:()=>!1}).then(n=>{n.isConfirmed&&(h.value=!1,O.value=!0)})}async function P(){const n=o.cart_id;try{const r=`https://backend-production-2f21.up.railway.app/api/carts/${n}`,s=await v.delete(r);s.data&&s.data.status==!0?(o.productsOnCart=[],f.value=0):(x.value=!0,w="There was an error trying to remove products from the cart")}catch{x.value=!0,w="There was an error trying to remove products from the cart"}}async function L(){E=null,C.value=!1,k.value=!1}async function R(){const n=o.cart_id,r=new MercadoPago("TEST-9a6af9fc-8332-4bc2-8364-65d306126962",{locale:"en-US"});S.value=!0;try{const s=`https://backend-production-2f21.up.railway.app/api/carts/${n}/create_preference`,e=await v.post(s);if(console.log(e.data.preference_id),e&&e.data.preference_id){const c=e.data.preference_id;r.bricks().create("wallet","mp",{initialization:{preferenceId:c,redirectMode:"modal"},callbacks:{onReady:()=>{},onSubmit:()=>{console.log("ON SUBMIT CALLBACK"),T.value=!0},onError:z=>console.error(z)}})}}catch(s){console.log(s),Swal.fire({title:"Error!",text:"Ups we have a problem to generate your payment. Try again.",icon:"error",confirmButtonText:"OK"}),T.value=!1,O.value=!1,h.value=!0,S.value=!1}}async function j(){const n=o.cart_id;if(console.log(n),n)try{const r=`https://backend-production-2f21.up.railway.app/api/carts/${n}/purchase`,s=await v.post(r);if(console.log(s),s&&s.data.status==!1&&s.data.pending_payment==!0){Swal.fire({title:"INFO",text:"Payment required!",icon:"warning",confirmButtonText:"OK"});return}else if(s.data.status==!0&&s.data.pending_payment==!1){let e=[];for await(let c of s.data.products_success)e.push(c._id);o.productsOnCart=o.productsOnCart.filter(c=>!e.includes(c._id)),f.value=0,o.productsOnCart.forEach(c=>{f.value+=c.price*c.quantity}),console.log("response transaction: ",s.data.transaction),E=s.data,s.data.transaction=="complete"?(localStorage.setItem("cart_id",""),o.productsOnCart=[],f.value=0,Swal.fire({title:"SUCCESS",text:"Purchase completed! We will shortly be sending you an email with your purchase details. Thanks for trusting us!",icon:"success",confirmButtonText:"OK"})):(C.value=!0,Swal.fire({title:"SUCCESS",text:"Your purchase was successull! Although due to lack of stock some of your products could not be included.Dont worry, you can continue shopping and we will notify you when there is stock!. And we will refund your money inmediate.",icon:"success",confirmButtonText:"OK"}))}}catch(r){console.log(r),Swal.fire({title:"Error",text:"There was an error to finish purchase. Try again.",icon:"error",confirmButtonText:"OK"});return}else Swal.fire({title:"Error!",text:"There was an error trying to finish purchase. cart id not found. Please login again and retry your purchase.",icon:"error",confirmButtonText:"OK"})}return o.productsOnCart.forEach(n=>{f.value+=n.price*n.quantity}),(n,r)=>{const s=W("RouterLink");return l(),u(B,null,[_(X),t("div",Q,[t("div",V,[t("div",Z,[t("div",tt,[t("div",et,[at,a(g).user.role=="user"||a(g).user.role=="premium"?(l(),u("div",st,[a(h)==!0?(l(),u("button",{key:0,onClick:r[0]||(r[0]=e=>P()),class:y(a(o).productsOnCart.length>0?"mt-4 p-4 bg-gray-600 mr-2 text-white text-center py-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-50":" disabled-opacity-50 mt-4 p-4 bg-gray-600 mr-2 text-white text-center py-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-50")}," Empty Cart ",2)):d("",!0)])):d("",!0)]),t("div",rt,[t("div",ot,[t("table",nt,[it,t("tbody",ct,[(l(!0),u(B,null,H(a(o).productsOnCart,e=>(l(),u("tr",null,[t("td",lt,[t("div",ut,[t("div",dt,[t("img",{class:"w-full h-full object-contain rounded-md",src:e.thumbnails,alt:""},null,8,ft)]),t("div",pt,[t("div",gt,m(e.productName),1),t("div",yt,m(e.type),1)])])]),t("td",mt,[t("div",ht,m(e.price),1)]),t("td",xt,[t("div",wt,[a(h)==!0?(l(),u("button",{key:0,class:"text-gray-500 hover:text-gray-700",onClick:c=>U(e._id),"aria-label":"Decrease quantity"},Ct,8,vt)):d("",!0),t("span",kt,m(e.quantity),1),a(h)==!0?(l(),u("button",{key:1,class:"text-gray-500 hover:text-gray-700",onClick:c=>M(e._id),"aria-label":"Increase quantity"},St,8,Ot)):d("",!0)])]),t("td",_t,[t("div",Et,"$"+m(Math.round(e.quantity*e.price*1e12)/1e12),1)]),t("td",Bt,[a(h)==!0?(l(),u("button",{key:0,class:"text-gray-500 hover:text-gray-700",onClick:c=>q(e._id),"aria-label":"Remove item"},At,8,It)):d("",!0)])]))),256))])])])])])]),t("div",Mt,[t("div",qt,[Ut,t("div",Nt,[t("div",Pt,[Lt,t("span",null,"$"+m(Math.round(a(f)*1e11)/1e11),1)]),Rt,jt,t("div",zt,[Kt,t("span",null,"$"+m(Math.round(a(f)*1e11)/1e11),1)]),a(g).user.role=="user"||a(g).user.role=="premium"?(l(),u("div",Yt,[a(h)==!0?(l(),u("div",Dt,[Gt,t("button",{onClick:N,class:y(a(o).productsOnCart.length>0?"mt-4 w-full bg-gray-800 text-white text-center py-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-50":" mt-4 w-full bg-gray-800 text-white text-center py-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-50 disabled-opacity-50")}," CONFIRM CART ",2)])):d("",!0),a(O)==!0&&a(S)==!1?(l(),u("div",Wt,[Ht,t("button",{onClick:R,class:y(a(o).productsOnCart.length>0?"mt-4 w-full bg-gray-800 text-white text-center py-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-50":" mt-4 w-full bg-gray-800 text-white text-center py-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-50 disabled-opacity-50")}," PAY WITH MERCADOPAGO ",2)])):d("",!0),Ft,a(T)==!0?(l(),u("div",Xt,[Jt,t("button",{onClick:j,class:y(a(o).productsOnCart.length>0?"mt-4 w-full bg-gray-800 text-white text-center py-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-50":" mt-4 w-full bg-gray-800 text-white text-center py-2 rounded-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 focus:ring-offset-gray-50 disabled-opacity-50")}," Checkout ",2)])):d("",!0)])):d("",!0)])])])])]),_(F,{name:"fade",duration:{enter:"1000",leave:"2000"}},{default:I(()=>[a(x)?(l(),u("div",Qt,[t("div",Vt,m(a(w)),1),t("button",{style:{width:"5%"},class:"",onClick:A},"X")])):d("",!0)]),_:1}),a(g).user.role=="user"||a(g).user.role=="premium"?(l(),u("div",Zt,[t("div",{class:y([a(k)?"scale-100":"","fixed scale-0 z-10 inset-0 overflow-y-auto"])},[t("div",te,[ee,t("div",{class:y([a(k)?"scale-100":"","transform scale-0 transition-transform duration-300 relative z-10 w-full max-w-md p-6 bg-white rounded-lg shadow-lg"])},[ae,se,t("div",re,[t("button",oe,[_(s,{onClick:a(o).clearCart,to:"/"},{default:I(()=>[$("Go Back to shopping")]),_:1},8,["onClick"])])])],2)])],2)])):d("",!0),a(g).user.role=="user"||a(g).user.role=="premium"?(l(),u("div",ne,[t("div",{class:y([a(C)?"scale-100":"","fixed scale-0 z-10 inset-0 overflow-y-auto"])},[t("div",ie,[ce,t("div",{class:y([a(C)?"scale-100":"","transform scale-0 transition-transform duration-300 relative z-10 w-full max-w-md p-6 bg-white rounded-lg shadow-lg"])},[le,ue,t("div",de,[t("button",{onClick:r[1]||(r[1]=e=>L()),class:"px-4 py-2 text-sm font-medium text-white bg-green-500 rounded hover:bg-green-600 focus:outline-none focus:ring focus:ring-green-500"}," Go Back to shopping ")])],2)])],2)])):d("",!0)],64)}}},me=J(fe,[["__scopeId","data-v-03e96025"]]);export{me as default};
